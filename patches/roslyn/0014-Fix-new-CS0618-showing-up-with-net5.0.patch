From 44ead158f2e5b0410f600baaa7286ea5bd7545ae Mon Sep 17 00:00:00 2001
From: Davis Goodin <dagood@microsoft.com>
Date: Tue, 29 Dec 2020 00:39:00 -0600
Subject: [PATCH 3/5] Fix new CS0618 showing up with net5.0

---
 Directory.Build.props                       |  2 +-
 src/Compilers/Core/MSBuildTask/Utilities.cs | 14 ++++++++------
 2 files changed, 9 insertions(+), 7 deletions(-)

diff --git a/Directory.Build.props b/Directory.Build.props
index aaa1d5b9fe5..e468e163eb6 100644
--- a/Directory.Build.props
+++ b/Directory.Build.props
@@ -4,7 +4,7 @@
   <Import Project="eng\targets\Settings.props" />
 
   <PropertyGroup>
-    <WarningsNotAsErrors>$(WarningsNotAsErrors);CS0618;CS8600;CS8602;CS8603;CS8604;CS8777</WarningsNotAsErrors>
+    <WarningsNotAsErrors>$(WarningsNotAsErrors);CS8600;CS8602;CS8603;CS8604;CS8605;CS8777</WarningsNotAsErrors>
   </PropertyGroup>
 
 </Project>
diff --git a/src/Compilers/Core/MSBuildTask/Utilities.cs b/src/Compilers/Core/MSBuildTask/Utilities.cs
index 74da0c2bdd3..b6af0715406 100644
--- a/src/Compilers/Core/MSBuildTask/Utilities.cs
+++ b/src/Compilers/Core/MSBuildTask/Utilities.cs
@@ -154,12 +154,14 @@ internal static void DeleteNoThrow(string path)
 
         internal static string? TryGetAssemblyPath(Assembly assembly)
         {
-            if (assembly.GlobalAssemblyCache)
-            {
-                return null;
-            }
-
-            if (assembly.CodeBase is { } codebase)
+            // Removed: error CS0618: 'Assembly.GlobalAssemblyCache' is obsolete: 'The Global Assembly Cache is not supported.'
+            // if (assembly.GlobalAssemblyCache)
+            // {
+            //     return null;
+            // }
+
+            // error CS0618: 'Assembly.CodeBase' is obsolete: 'Assembly.CodeBase and Assembly.EscapedCodeBase are only included for .NET Framework compatibility. Use Assembly.Location instead.'
+            if (assembly.Location is { } codebase)
             {
                 var uri = new Uri(codebase);
                 return uri.IsFile ? uri.LocalPath : assembly.Location;
-- 
2.25.4

